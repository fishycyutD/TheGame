<!DOCTYPE html>
<html>
    <head>
        <title>TileMap Test</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
        <style>
            .dialouge {
                display: block;
                position: fixed;
                font-family: "Pixelify Sans", sans-serif;
            }
            #tileForDupe {
                image-rendering: pixelated;
                image-rendering: crisp-edges;
                width: 8.33333333333334%;
                height: 16.66666666666667%;
                position: absolute;
                top: 0px;
                left: 0px;
            }
            #character {
                position: fixed;
                top: 50%;
                left: 50%;
                translate: (-50%, -50%);
                z-index: 1;
                image-rendering: pixelated;
                image-rendering: crisp-edges;
                width: 50px;
                height: 100px;
            }
            body {
                overflow: hidden;
                scroll-behavior: smooth;
            }
        </style>
    </head>
    <body>
        <!-- Dialouge -->
        <img id="dialougeProfile" src="Textures/stupid evbo.jfif" class="dialouge" style="z-index:10; top: 40%; left: 10%; transform: translateY(-50%); width: 20%;">
        <div class="dialouge" id="nameBox" style="z-index: 11; top: 60%; left: 10%; width: 80%; height: 5%; position: relative;">
            <h1 id="dialougeName" class="dialouge" id="name" style="color: black; opacity: 1; font-size: 180%; top: 57%;">Evbo</h1>
        </div>
        <div class="dialouge" id="chatBox" style="z-index: 11; top: 70%; left: 10%; background-color: green;">
            <h1 id="dialougeChat" class="dialouge" id="chat"></h1>
        </div>
        <!-- Other --> 
        <div class="dialouge" id="background" style="z-index: 9; top: 60%; left: 10%; width: 80%; height: 30%; opacity: 0.5; background-color: grey"></div>
        <img class="tile" src="Textures/Grass.png" id="tileForDupe">
        <img id="character" src="Textures/Character(front, idle).png">
        <script>
            //dialouge variables
                //elements
                let dialougeProfile = document.getElementById("dialougeProfile");
                let dialougeName = document.getElementById("dialougeName");
                let dialougeChat = document.getElementById("dialougeChat");
                let dialouges = Array.from(document.getElementsByClassName("dialouge"));
                //values
                let dialougeProfileV;
                let dialougeNameV;
                let dialougeChatV;
                //michellaneous
                let i = 0;
            //supporting variables
            let mapCount = 0;
            let interval;
            let time = 0;
            let keydown = false;
            let moveSpeed = 10; //speed
            let sprintSpeed = 20; //sprint speed
            
            
            //elements
            const character = document.getElementById("character");
            const tiles = document.getElementsByClassName("tile");
            const tileForDupe = document.getElementById("tileForDupe");
            
            const mapSizes = {//w, h
                map1: [3, 3],
                map2: [3, 3]
            }
                        //arrays
            let solidTiles = [];
            let interactableTiles = [];
            let interactableElements = [];
            let tpTiles = [];
            let tpElements = [];
            allTiles = [];
            //tile position
            let tileX = 0;
            let tileY = 0;
            //screen size
            let screensizeW = window.innerWidth;
            let screensizeH = window.innerHeight;
            //tile fit
            let width = window.getComputedStyle(tileForDupe).width;
            let height = window.getComputedStyle(tileForDupe).height;
            if (width.includes("px")) {
                width = parseFloat(width.replace(/px/g, ""));
                height = parseFloat(height.replace(/px/g, ""));
            }
            const tileFitX = Math.floor(screensizeW/width);
            const tileFitY = Math.floor(screensizeH/height);
            let currentFitX = 0;
            let currentFitY = 0;
            let PercentageX = screensizeW/tileFitX;
            let PercentageY = screensizeH/tileFitY;
            //PBR is used for calculations of tiles
            /* Percentage(screensize/tileFit) / Base(screensize) = Rate(size of each tile) */
            let RateX = PercentageX/screensizeW;
            let RateY = PercentageY/screensizeH;
            /*Block {
                name: true;
                source: true;
                solid: true;
                rotation: true;
                *chat: null;
            }
            array[name, profile, dialouge]
            *chat: array;*/
            const ashswag = {
                name: "corrupted",
                source: "Textures/ashswag.png",
                solid: false,
                rotation: 0,
                interactable: false,
            }
            const voidBlock = {
                name: "void",
                source: "Textures/Void.png",
                solid: true,
                rotation: 0,
            }
            const Grass = {
                name: "grass",
                source: "Textures/Grass.png",
                solid: false,
                rotation: 0,
                interactable: false,
            }
            const PathVertical = {
                name: "pathVertical",
                source: "Textures/PathVertical.png",
                solid: false,
                rotation: 0,
                interactable: false,
            }
            const PathHorizontal = {
                name: "pathHorizontal",
                source: "Textures/PathVertical.png",
                solid: false,
                rotation: 90,
                interactable: false,
            }
            const PathLeftDown = {
                name: "pathLeftDown",
                source: "Textures/PathLeftDown.png",
                solid: false,
                rotation: 0,
                interactable: false,
            }
            
            const Orb = {
                name: "orb",
                source: "Textures/Orb.png",
                solid: true,
                rotation: 0,
                interactable: false,
            }
            const floortile = {
                name: "Floor",
                source: "Textures/floortile.png",
                solid: false,
                rotation: 0,
                interactable: false,
            }
            const table = {
                name: "Table",
                source: "Textures/table.png",
                solid: true,
                rotation: 0,
                interactable: false,
            }
            const wood = {
                name: "wooden",
                source: "Textures/wood.png",
                solid: true,
                rotation: 0,
                interactable: false,
            }
            const sign = {
                name: "Sign",
                source: "Textures/sign.png",
                solid: false,
                rotation: 0,
                interactable: [{profile: "Textures/sign.png", name: "Sign", chat: "Hello. This is a sign."}, {profile: "Textures/sign.png", name: "Sign", chat: "There is a message to be sent to you."}, {profile: "Textures/sign.png", name: "Sign", chat: "Happy Birthday Ate Ish!"}, {profile: null, name: null, chat: null,}],
            }
            
            const theVoid = voidBlock.name;
            const grass = Grass.name;
            const pathVertical = PathVertical.name;
            const pathHorizontal = PathHorizontal.name;
            const pathLeftDown = PathLeftDown.name;
            const orb = Orb.name;
            const Floor = floortile.name;
            const Table = table.name;
            const wooden = wood.name;
            const Sign = sign.name;
            
            
            let sixSevenDoor = {
                name: "sixSeven",
                source: "Textures/67door.png",
                solid: false,
                rotation: 0,
                interactable: false,
                tp: null
            }
            const tileTypes = [voidBlock, Grass, PathVertical, PathHorizontal, PathLeftDown, Orb, sixSevenDoor, floortile, table, wood, sign];
            const sixSeven = sixSevenDoor.name;
            const map = [grass,grass,grass,grass,wooden,wooden,wooden,wooden,wooden,wooden,wooden,wooden,wooden,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,wooden,Floor,Floor,Floor,Floor,Floor,Floor,Table,wooden,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,wooden,Floor,Floor,Floor,Floor,Floor,Floor,Table,wooden,theVoid,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,wooden,Floor,Floor,Floor,Floor,Floor,Floor,Table,wooden,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,grass,grass,grass,grass,grass,grass,grass,wooden,Floor,Floor,Floor,Floor,Floor,Floor,orb,wooden,theVoid,theVoid,theVoid,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,theVoid,orb,theVoid,theVoid,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,wooden,Floor,Floor,Floor,Floor,Floor,Floor,Table,wooden,theVoid,grass,theVoid,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,theVoid,theVoid,theVoid,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,wooden,wooden,wooden,sixSeven,wooden,wooden,wooden,wooden,wooden,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathHorizontal,pathLeftDown,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,pathVertical,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,pathVertical,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,pathVertical,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,pathHorizontal,theVoid,pathLeftDown,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,pathVertical,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,Sign,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass];
            const map2 = [grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,theVoid,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass,grass];
            sixSevenDoor.tp = [map, mapSizes.map1, 0, 0]; //map, size, xcords, ycords
            
            
            //functions
            function isColliding (element1, element2) {
                const ele1 = element1.getBoundingClientRect();
                const ele2 = element2.getBoundingClientRect();

                return(
                    ele1.left < ele2.right &&
                    ele1.right > ele2.left &&
                    ele1.top < ele2.bottom &&
                    ele1.bottom > ele2.top
                );
            }
            function getTile (tile) {
                for(let ii = 0; ii < tileTypes.length; ii++) {
                    if(tileTypes[ii].name === tile) {
                        return tileTypes[ii];
                    }
                }
                return ashswag;//error tile
            }
            function changePosition (element) {
                    element.style.top = tileY+"px";
                    element.style.left = tileX+"px";
                    }
            function updateDialouge() {
                dialougeProfile.src = dialougeProfileV;
                dialougeName.textContent = dialougeNameV;
                dialougeChat.textContent = dialougeChatV;
            }
            function showDialouge() {
                dialouges.forEach(ele => {
                    ele.style.display = "block";
                });
            }
            function hideDialouge() {
                dialouges.forEach(ele => {
                    ele.style.display = "none";
                });
                i = 0;
            }
            function nextDialouge(prof, nam, cha, MaxIndex, tile) {
                if(!(i===MaxIndex)) {
                    i++;
                    dialougeProfileV = prof;
                    dialougeNameV = nam;
                    dialougeChatV = cha;
                    updateDialouge();
                    if(!(i===MaxIndex)) {
                        setTimeout(() => {
                            nextDialouge(tile.interactable[i].profile, tile.interactable[i].name, tile.interactable[i].chat, MaxIndex, tile);
                        }, 5000);
                    } else {
                        hideDialouge();
                    }
                } else {
                    hideDialouge();
                }
            }
            function stamp (tile, size, xcords, ycords) {
                const dupe = tileForDupe.cloneNode(false);
                dupe.src = tile.source;
                changePosition(dupe);
                document.body.appendChild(dupe);
                tileX+=width;
                currentFitX+=1;
                dupe.style.transform = `rotate(${tile.rotation}deg)`;
                if(tileX > screensizeW*size[0]) {
                    tileX = 0;
                    currentFitX = 0;
                    tileY+=height;
                    currentFitY+=1;
                }
                if(tile.solid) {solidTiles.push(dupe);}
                if(!tile.interactable===false) {interactableTiles.push(tile); interactableElements.push(dupe);}
                if(!tile.tp===null) {tpTiles.push(tile); tpElements.push(dupe);}
                allTiles.push(dupe);
                window.scrollTo((screensizeW/1000)*xcords, (screensizeH/1000)*ycords);
            }
            
            
            dialouges.forEach(ele => {
                ele.style.display = "none";
            });
            //initial map generation
            function initialMapGeneration(size, specMap, xcords/*1 screen width is a thousand xcoordinate units, same for ycords*/, ycords) {
                if(allTiles.length>0) {allTiles.splice(0, allTiles.length);}
                for(let i = 0; mapCount<specMap.length; i++) {
                            stamp(getTile(map[mapCount]), size, xcords, ycords);
                            mapCount++;
                        }
                    }
            initialMapGeneration(mapSizes.map1, map, 0, 0);
            document.addEventListener("keydown", (event) => {
                event.preventDefault();
                if(!keydown) {
                    keydown = true;
                    character.src = "Textures/Character(front, animate).gif";
                    interval = setInterval(() => {
                        if(event.key.startsWith("Arrow")) {
                            if(event.ctrlKey) {var speed = sprintSpeed} else {var speed = moveSpeed} 
                            switch (event.key) {
                                case "ArrowUp" : window.scrollBy(0, -speed); break;
                                case "ArrowDown" : window.scrollBy(0, speed); break;
                                case "ArrowLeft" : window.scrollBy(-speed, 0); break;
                                case "ArrowRight" : window.scrollBy(speed, 0); break;
                            }
                        }
                        solidTiles.forEach(tile => {
                            if(isColliding(tile, character)) {
                                switch (event.key) {
                                case "ArrowUp" : window.scrollBy(0, speed); break;
                                case "ArrowDown" : window.scrollBy(0, -speed); break;
                                case "ArrowLeft" : window.scrollBy(speed, 0); break;
                                case "ArrowRight" : window.scrollBy(-speed, 0); break;
                            }
                            }
                        });
                    }, 50);
                    if(event.key === "e") {
                        interactableTiles.forEach(tile => {
                            interactableElements.forEach(element => {
                                if(isColliding(element, character)) {
                                    showDialouge();
                                    nextDialouge(tile.interactable[i].profile, tile.interactable[i].name, tile.interactable[i].chat, tile.interactable.length, tile);
                                }
                            });
                        });
                        tpTiles.forEach((tile, index) => {
                            let element = tpElements[index];
                            if(isColliding(element, character)) {
                                allTiles.forEach(ele => {
                                    ele.remove();
                                });
                                
                                initialMapGeneration(tile.tp[1], tile.tp[0], tile.tp[2], tile.tp[3]);
                            }
                        });
                    }
                }
            });
            document.addEventListener("keyup", () => {
                    character.src = "Textures/Character(front, idle).png";
                    clearInterval(interval);
                    keydown = false;
            });
            window.addEventListener("wheel", (event) => {
                event.preventDefault();
            }, { passive: false });
        </script>
    </body>
</html>